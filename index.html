<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Class Live Score</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;800&family=Prompt:wght@400;700&display=swap" rel="stylesheet">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #0f172a; 
            color: white;
            transition: overflow 0.3s ease;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .score-text {
            font-family: 'Prompt', sans-serif;
            text-shadow: 0 0 25px rgba(234, 179, 8, 0.7);
        }
        .animate-pop {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(0.6); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .scrolling-comments {
            mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
        .toggle-btn { transition: all 0.3s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // üîß ‡∏•‡∏¥‡∏á‡∏Å‡πå API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π
        // ==========================================
        const API_URL = "https://script.google.com/macros/s/AKfycbxKASLcbvdwOA85PaqzLkyYQ9-3TO9zDPHXJ4Xt1hNudha45A8vwPxAZS5kUQ0doow/exec"; 
        
        const App = () => {
            // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö‡∏à‡∏≤‡∏Å URL (URL Parameters)
            const urlParams = new URLSearchParams(window.location.search);
            const urlRoom = urlParams.get('room'); 
            
            // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
            const grades = ["1", "2", "3", "4", "5", "6"];
            const rooms = Array.from({length: 15}, (_, i) => `${i+1}`);
            const targets = Array.from({length: 50}, (_, i) => `${i+1}`);

            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ URL ‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏ß‡πâ
            let initGrade = "1";
            let initRoom = "1";
            let isLockedByURL = false;

            if (urlRoom && urlRoom.includes('/')) {
                const parts = urlRoom.split('/');
                if (grades.includes(parts[0]) && rooms.includes(parts[1])) {
                    initGrade = parts[0];
                    initRoom = parts[1];
                    isLockedByURL = true; // ‡∏™‡∏±‡πà‡∏á‡∏•‡πá‡∏≠‡∏Å!
                }
            }

            // State ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
            const [selectedGrade, setSelectedGrade] = useState(initGrade);
            const [selectedRoom, setSelectedRoom] = useState(initRoom);
            const [evalMode, setEvalMode] = useState("‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß");
            const [selectedTarget, setSelectedTarget] = useState("");
            const [refreshTrigger, setRefreshTrigger] = useState(0);
            
            // State ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
            const [isLocked, setIsLocked] = useState(true);
            const [showQR, setShowQR] = useState(false); // üåü State ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î QR Code
            
            // State ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            const [score, setScore] = useState(0);
            const [displayScore, setDisplayScore] = useState(0);
            const [comments, setComments] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState("");

            const fullClassName = `${selectedGrade}/${selectedRoom}`;

            useEffect(() => {
                document.body.style.overflow = isLocked ? 'hidden' : 'auto';
                return () => { document.body.style.overflow = 'auto'; };
            }, [isLocked]);

            useEffect(() => {
                if (!selectedTarget) {
                    setScore(0);
                    setComments([]);
                    return;
                }

                if (API_URL.includes("‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå")) {
                    setError("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Web App URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
                    return;
                }

                setIsLoading(true);
                setError("");

                const fetchUrl = `${API_URL}?room=${encodeURIComponent(fullClassName)}&type=${encodeURIComponent(evalMode)}&id=${encodeURIComponent(selectedTarget)}`;

                fetch(fetchUrl)
                    .then(response => response.json())
                    .then(data => {
                        setScore(parseFloat(data.score) || 0);
                        let rawComments = data.comments ? String(data.comments) : "";
                        let commentArray = [];
                        if (rawComments && rawComments !== "-" && rawComments !== "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô") {
                            commentArray = rawComments.split(/[-]{5,}/).map(c => c.trim()).filter(c => c.length > 0); 
                        }
                        setComments(commentArray);
                        setIsLoading(false);
                    })
                    .catch(err => {
                        console.error("Error fetching data:", err);
                        setError("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
                        setIsLoading(false);
                    });

            }, [selectedTarget, fullClassName, evalMode, refreshTrigger]);

            useEffect(() => {
                let start = displayScore;
                const end = score;
                if (start === end) return;
                const duration = 1200;
                const startTime = performance.now();
                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
                    setDisplayScore(start + (end - start) * ease);
                    if (progress < 1) requestAnimationFrame(animate);
                };
                requestAnimationFrame(animate);
            }, [score]);

            const handleModeChange = (mode) => {
                setEvalMode(mode);
                setSelectedTarget(""); 
            };

            const handleRefresh = () => {
                if (!isLoading && selectedTarget) setRefreshTrigger(prev => prev + 1);
            };

            const toggleLock = () => setIsLocked(!isLocked);

            return (
                <div className={`min-h-screen flex flex-col items-center justify-center p-4 md:p-6 relative bg-[#0f172a] ${isLocked ? 'overflow-hidden' : 'overflow-auto pb-10'}`}>
                    
                    <div className="absolute top-0 left-0 w-full h-full z-0 opacity-40 pointer-events-none">
                        <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-600 rounded-full mix-blend-screen filter blur-[100px] animate-pulse"></div>
                        <div className="absolute top-[20%] right-[-10%] w-[30%] h-[50%] bg-purple-600 rounded-full mix-blend-screen filter blur-[120px] opacity-70" style={{animation: 'pulse 4s infinite alternate'}}></div>
                        <div className="absolute bottom-[-20%] left-[20%] w-[50%] h-[40%] bg-indigo-600 rounded-full mix-blend-screen filter blur-[100px] opacity-60" style={{animation: 'pulse 5s infinite alternate-reverse'}}></div>
                    </div>

                    <div className="z-20 w-full max-w-6xl mb-6 p-4 md:p-1 md:pl-6 glass-panel rounded-3xl md:rounded-full flex flex-col md:flex-row items-center justify-between shadow-2xl gap-4 md:gap-0">
                        <div className="flex items-center gap-4 w-full md:w-auto justify-center md:justify-start">
                            <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 flex items-center justify-center shadow-lg shrink-0">
                                <i className="fa-solid fa-music text-white text-sm"></i>
                            </div>
                            <div className="text-center md:text-left">
                                <h1 className="font-bold text-white text-lg leading-tight">Live Stage</h1>
                                <p className="text-blue-300 text-xs font-medium uppercase tracking-widest">Score System</p>
                            </div>
                        </div>

                        <div className="flex flex-wrap items-center justify-center gap-2 md:gap-3 bg-slate-900/50 p-2 rounded-2xl md:rounded-full border border-slate-700/50 backdrop-blur-md w-full md:w-auto">
                            
                            {/* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á */}
                            <div className={`flex items-center rounded-full px-3 md:px-4 py-1.5 border transition-colors ${isLockedByURL ? 'bg-slate-800/50 border-slate-700/50 opacity-80' : 'bg-slate-800 border-slate-700'}`}>
                                <span className="text-gray-400 text-xs md:text-sm mr-1 md:mr-2 font-medium">‡∏°.</span>
                                <select 
                                    value={selectedGrade}
                                    onChange={(e) => {setSelectedGrade(e.target.value); setSelectedTarget("");}}
                                    disabled={isLockedByURL}
                                    className={`bg-transparent text-white font-bold text-base md:text-lg focus:outline-none appearance-none text-center w-5 md:w-6 ${isLockedByURL ? 'cursor-not-allowed text-gray-300' : 'cursor-pointer'}`}
                                >
                                    {grades.map(g => <option key={g} value={g} className="bg-slate-800">{g}</option>)}
                                </select>
                                <span className="text-gray-400 text-base md:text-lg mx-1">/</span>
                                <select 
                                    value={selectedRoom}
                                    onChange={(e) => {setSelectedRoom(e.target.value); setSelectedTarget("");}}
                                    disabled={isLockedByURL}
                                    className={`bg-transparent text-white font-bold text-base md:text-lg focus:outline-none appearance-none text-center min-w-[20px] ${isLockedByURL ? 'cursor-not-allowed text-gray-300' : 'cursor-pointer'}`}
                                >
                                    {rooms.map(r => <option key={r} value={r} className="bg-slate-800">{r}</option>)}
                                </select>
                                
                                {isLockedByURL ? (
                                    <i className="fa-solid fa-lock text-slate-500 ml-1 md:ml-2 text-[10px] md:text-xs"></i>
                                ) : (
                                    <i className="fa-solid fa-caret-down text-gray-500 ml-1 md:ml-2 text-[10px] md:text-xs pointer-events-none"></i>
                                )}
                            </div>

                            <div className="hidden md:block w-px h-8 bg-slate-700 mx-1"></div>

                            {/* Mode Toggle */}
                            <div className="flex p-1 bg-slate-800 rounded-full border border-slate-700">
                                <button 
                                    onClick={() => handleModeChange("‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß")}
                                    className={`px-3 md:px-4 py-1.5 rounded-full text-xs md:text-sm font-semibold flex items-center gap-1.5 md:gap-2 transition-all duration-300 ${evalMode === "‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß" ? "bg-blue-500 text-white shadow-[0_0_15px_rgba(59,130,246,0.6)]" : "bg-white/10 text-gray-400 hover:bg-white/20"}`}
                                >
                                    <i className="fa-solid fa-user text-[10px] md:text-xs"></i> ‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß
                                </button>
                                <button 
                                    onClick={() => handleModeChange("‡∏Å‡∏•‡∏∏‡πà‡∏°")}
                                    className={`px-3 md:px-4 py-1.5 rounded-full text-xs md:text-sm font-semibold flex items-center gap-1.5 md:gap-2 transition-all duration-300 ${evalMode === "‡∏Å‡∏•‡∏∏‡πà‡∏°" ? "bg-purple-500 text-white shadow-[0_0_15px_rgba(168,85,247,0.6)]" : "bg-white/10 text-gray-400 hover:bg-white/20"}`}
                                >
                                    <i className="fa-solid fa-users text-[10px] md:text-xs"></i> ‡∏Å‡∏•‡∏∏‡πà‡∏°
                                </button>
                            </div>

                            <div className="hidden md:block w-px h-8 bg-slate-700 mx-1"></div>

                            {/* Target Selector */}
                            <div className="relative w-full md:w-auto mt-2 md:mt-0 flex justify-center">
                                <select 
                                    value={selectedTarget}
                                    onChange={(e) => setSelectedTarget(e.target.value)}
                                    className="bg-blue-600 hover:bg-blue-500 transition-colors text-white font-bold text-sm md:text-base rounded-full px-5 md:px-6 py-2 pr-10 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-lg cursor-pointer w-full max-w-[200px] md:max-w-none md:min-w-[140px]"
                                >
                                    <option value="">{evalMode === "‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß" ? "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà" : "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°"}</option>
                                    {targets.map(t => (
                                        <option key={t} value={t} className="bg-slate-800 text-white">
                                            {evalMode === "‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß" ? `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${t}` : `‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà ${t}`}
                                        </option>
                                    ))}
                                </select>
                                <div className="absolute right-4 md:right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-white/70">
                                    <i className="fa-solid fa-play text-[10px] md:text-xs"></i>
                                </div>
                            </div>
                            
                            {/* Action Buttons (QR + Refresh + Lock) */}
                            <div className="flex items-center gap-2 mt-2 md:mt-0">
                                
                                {/* üåü ‡∏õ‡∏∏‡πà‡∏° QR Code ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á (‡∏à‡∏≠‡∏Ñ‡∏£‡∏π) */}
                                {!isLockedByURL && (
                                    <>
                                        <button
                                            onClick={() => setShowQR(true)}
                                            className="w-9 h-9 md:w-10 md:h-10 rounded-full flex items-center justify-center transition-all duration-300 focus:outline-none bg-green-500/20 text-green-400 border border-green-500/50 shadow-[0_0_10px_rgba(34,197,94,0.3)] hover:bg-green-500/40"
                                            title="‡πÅ‡∏™‡∏î‡∏á QR Code ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô"
                                        >
                                            <i className="fa-solid fa-qrcode text-sm md:text-base"></i>
                                        </button>
                                        <div className="w-px h-6 bg-slate-700 mx-0.5"></div>
                                    </>
                                )}

                                {/* Refresh Button */}
                                <button
                                    onClick={handleRefresh}
                                    disabled={!selectedTarget || isLoading}
                                    className={`w-9 h-9 md:w-10 md:h-10 rounded-full flex items-center justify-center transition-all duration-300 focus:outline-none ${!selectedTarget ? 'bg-slate-800 text-slate-600 cursor-not-allowed border border-slate-700' : 'bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 shadow-lg hover:shadow-blue-500/20'}`}
                                    title="‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î"
                                >
                                    <i className={`fa-solid fa-rotate-right text-sm md:text-base ${isLoading ? 'animate-spin text-blue-400' : ''}`}></i>
                                </button>
                                
                                <div className="w-px h-6 bg-slate-700 mx-0.5"></div>

                                {/* Lock Button */}
                                <button
                                    onClick={toggleLock}
                                    className={`w-9 h-9 md:w-10 md:h-10 rounded-full flex items-center justify-center transition-all duration-300 focus:outline-none ${isLocked ? 'bg-red-500/20 text-red-400 border border-red-500/50 shadow-[0_0_10px_rgba(239,68,68,0.3)]' : 'bg-slate-800 hover:bg-slate-700 text-slate-400 border border-slate-700'}`}
                                    title={isLocked ? "‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏ß‡∏µ)" : "‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ)"}
                                >
                                    <i className={`fa-solid text-sm md:text-base ${isLocked ? 'fa-lock' : 'fa-unlock'}`}></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    {error && (
                        <div className="z-50 absolute top-32 md:top-24 bg-red-500/90 backdrop-blur-sm text-white px-6 py-3 rounded-2xl shadow-2xl animate-pop border border-red-400 text-sm md:text-base text-center w-11/12 md:w-auto">
                            <i className="fa-solid fa-triangle-exclamation mr-2"></i> {error}
                        </div>
                    )}

                    {/* Main Content (Score + Comments) */}
                    <div className="z-10 w-full max-w-6xl flex-1 flex flex-col md:flex-row gap-4 md:gap-6 min-h-0">
                        <div className="w-full md:w-3/5 flex flex-col gap-4 md:gap-6">
                            <div className="glass-panel rounded-[2rem] p-6 md:p-8 relative overflow-hidden flex flex-col justify-center min-h-[140px] md:min-h-[160px] border-t-4 border-t-blue-500">
                                <div className="absolute -right-6 -top-6 md:-right-10 md:-top-10 text-[8rem] md:text-[10rem] opacity-5 text-white pointer-events-none">
                                    <i className="fa-solid fa-microphone-lines"></i>
                                </div>
                                <h2 className="text-blue-300 mb-1 md:mb-2 font-medium tracking-[0.2em] text-xs md:text-sm flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                                    NOW SHOWING
                                </h2>
                                
                                {selectedTarget ? (
                                    <div className="animate-pop z-10">
                                        <div className="text-gray-400 text-sm md:text-lg mb-0 md:mb-1 font-medium">‡∏´‡πâ‡∏≠‡∏á ‡∏°.{fullClassName}</div>
                                        <h1 className="text-4xl md:text-6xl font-extrabold text-white tracking-tight leading-tight">
                                            {evalMode === "‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß" ? "‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà " : "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà "}<span className="text-yellow-400">{selectedTarget}</span>
                                        </h1>
                                    </div>
                                ) : (
                                    <h1 className="text-2xl md:text-4xl font-semibold text-gray-500/50 italic mt-2 md:mt-4 z-10">
                                        ‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á...
                                    </h1>
                                )}
                            </div>

                            <div className="glass-panel rounded-[2rem] p-8 md:p-10 flex-1 flex flex-col items-center justify-center relative shadow-2xl border border-white/5 min-h-[300px] md:min-h-0">
                                {isLoading ? (
                                    <div className="flex flex-col items-center gap-4 md:gap-6 animate-pop">
                                        <div className="relative scale-75 md:scale-100">
                                            <div className="w-24 h-24 border-4 border-slate-700 rounded-full"></div>
                                            <div className="w-24 h-24 border-4 border-blue-500 rounded-full absolute top-0 left-0 border-t-transparent animate-spin"></div>
                                            <i className="fa-solid fa-music absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-xl text-blue-400"></i>
                                        </div>
                                        <div className="text-blue-300 text-xs md:text-sm font-medium tracking-widest animate-pulse uppercase">Syncing Data...</div>
                                    </div>
                                ) : selectedTarget ? (
                                    <div className="w-full flex flex-col items-center animate-pop">
                                        <div className="text-gray-400 text-xs md:text-sm font-bold tracking-[0.2em] md:tracking-[0.3em] uppercase mb-2 md:mb-4 opacity-80 border-b border-gray-700 pb-2">Total Score</div>
                                        
                                        <div className="relative my-4 md:my-0">
                                            <div className="absolute top-1 md:top-2 left-0 w-full text-center text-[8rem] sm:text-[10rem] md:text-[14rem] font-black score-text text-yellow-600/20 leading-none blur-sm pointer-events-none select-none">
                                                {displayScore.toFixed(1)}
                                            </div>
                                            <div className="text-[8rem] sm:text-[10rem] md:text-[14rem] font-black score-text text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 leading-none relative z-10 filter drop-shadow-2xl">
                                                {displayScore.toFixed(1)}
                                            </div>
                                        </div>

                                        <div className="mt-8 md:mt-12 w-11/12 md:w-3/4 max-w-md bg-slate-800/80 rounded-full h-2 md:h-3 overflow-hidden border border-slate-700 shadow-inner">
                                            <div 
                                                className="bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 h-full rounded-full transition-all duration-1000 ease-out relative"
                                                style={{ width: `${Math.min((displayScore / 10) * 100, 100)}%` }} 
                                            >
                                                <div className="absolute top-0 right-0 w-10 h-full bg-white/30 blur-[2px] -skew-x-12 transform translate-x-5"></div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex flex-col items-center justify-center opacity-30">
                                        <div className="w-24 h-24 md:w-32 md:h-32 rounded-full border-2 border-dashed border-gray-500 flex items-center justify-center mb-4 md:mb-6">
                                            <i className="fa-solid fa-headphones text-3xl md:text-4xl text-gray-500"></i>
                                        </div>
                                        <p className="text-gray-400 text-sm md:text-base font-medium tracking-wide uppercase">Select Performer</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="w-full md:w-2/5 glass-panel rounded-[2rem] flex flex-col overflow-hidden border-t-4 border-t-purple-500 min-h-[400px] md:min-h-0">
                            <div className="bg-slate-900/40 p-4 md:p-6 flex items-center justify-between border-b border-white/5 backdrop-blur-md">
                                <div className="flex items-center gap-3">
                                    <div className="bg-purple-500/20 text-purple-400 w-8 h-8 md:w-10 md:h-10 rounded-xl flex items-center justify-center border border-purple-500/30 shrink-0">
                                        <i className="fa-solid fa-comment-dots text-base md:text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 className="text-base md:text-lg font-bold text-white leading-tight">Live Feedback</h3>
                                        <p className="text-gray-400 text-[10px] md:text-xs">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏°</p>
                                    </div>
                                </div>
                                <span className="bg-green-500/20 text-green-400 text-[9px] md:text-[10px] font-bold px-2.5 py-1 rounded-full border border-green-500/30 flex items-center gap-1.5 uppercase tracking-wider shrink-0">
                                    <span className="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span>
                                    Live
                                </span>
                            </div>

                            <div className="flex-1 overflow-y-auto p-4 md:p-6 scrolling-comments space-y-3 md:space-y-4 relative bg-slate-900/20">
                                {isLoading ? (
                                    <div className="space-y-4">
                                        {[1,2,3].map(i => (
                                            <div key={i} className="bg-slate-800/40 p-4 md:p-5 rounded-2xl border border-white/5 animate-pulse flex gap-3 md:gap-4">
                                                <div className="w-8 h-8 md:w-10 md:h-10 rounded-full bg-slate-700/50 shrink-0"></div>
                                                <div className="flex-1 space-y-2 py-1">
                                                    <div className="h-2.5 md:h-3 bg-slate-700/50 rounded w-1/4"></div>
                                                    <div className="h-3.5 md:h-4 bg-slate-700/50 rounded w-3/4"></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ) : comments.length > 0 ? (
                                    comments.map((comment, index) => (
                                        <div 
                                            key={index} 
                                            className="bg-slate-800/60 p-4 md:p-5 rounded-2xl border-l-4 border-l-purple-500 border border-white/5 shadow-lg animate-pop relative overflow-hidden group hover:bg-slate-800 transition-colors"
                                            style={{animationDelay: `${index * 80}ms`}}
                                        >
                                            <div className="flex gap-3 md:gap-4">
                                                <div className="w-8 h-8 md:w-10 md:h-10 rounded-full bg-slate-700 flex items-center justify-center text-gray-400 shrink-0 shadow-inner">
                                                    <i className="fa-solid fa-user-astronaut text-xs md:text-sm"></i>
                                                </div>
                                                <div>
                                                    <div className="text-purple-300 text-[10px] md:text-xs font-semibold mb-0.5 md:mb-1">‡∏ú‡∏π‡πâ‡∏ä‡∏°‡∏≠‡∏¥‡∏™‡∏£‡∏∞</div>
                                                    <p className="text-gray-100 text-sm md:text-base leading-relaxed font-light">"{comment}"</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                ) : (
                                    <div className="absolute inset-0 flex flex-col items-center justify-center text-gray-500/50">
                                        <i className="fa-regular fa-comments text-4xl md:text-5xl mb-3 md:mb-4 opacity-50"></i>
                                        <p className="font-medium text-sm md:text-base text-center px-4">{selectedTarget ? "‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏Å..." : ""}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="w-full text-center mt-6 md:mt-8 z-20">
                        <p className="text-slate-500 text-[10px] md:text-xs font-light tracking-widest uppercase">
                            &copy; {new Date().getFullYear()} Music Class Live System ‚Ä¢ Created by <span className="text-blue-400 font-medium">‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏¢‡∏ï‡∏£‡∏µ‡∏°‡∏ï‡∏¥‡∏û‡∏±‡∏í‡∏ô‡πå  ‡πÄ‡∏ä‡∏¥‡∏î‡∏™‡∏∏‡∏Ç @‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ò‡∏±‡∏ç‡∏£‡∏±‡∏ï‡∏ô‡πå</span>
                        </p>
                    </div>

                    {/* üåü Pop-up ‡πÅ‡∏™‡∏î‡∏á QR Code üåü */}
                    {showQR && (
                        <div 
                            className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-md p-4 animate-pop" 
                            onClick={() => setShowQR(false)}
                        >
                            <div 
                                className="bg-slate-800 p-8 md:p-10 rounded-[2rem] border border-slate-700 shadow-[0_0_50px_rgba(34,197,94,0.15)] flex flex-col items-center max-w-sm w-full relative" 
                                onClick={e => e.stopPropagation()}
                            >
                                <button 
                                    onClick={() => setShowQR(false)}
                                    className="absolute top-4 right-4 text-slate-400 hover:text-white bg-slate-700/50 hover:bg-red-500 w-8 h-8 rounded-full flex items-center justify-center transition-colors"
                                >
                                    <i className="fa-solid fa-xmark"></i>
                                </button>
                                
                                <div className="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mb-4 border border-green-500/30 text-green-400 shadow-inner">
                                    <i className="fa-solid fa-qrcode text-3xl"></i>
                                </div>
                                
                                <h2 className="text-2xl font-bold text-white mb-2 text-center">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
                                <p className="text-slate-400 text-sm text-center mb-6">‡∏´‡∏¢‡∏¥‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code<br/>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                                
                                <div className="bg-white p-4 rounded-xl mb-6 shadow-inner ring-4 ring-white/10">
                                    <img 
                                        src="https://i.ibb.co/nMgctVbY/ii.png" 
                                        alt="QR Code ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô" 
                                        className="w-48 h-48 md:w-56 md:h-56 object-contain" 
                                    />
                                </div>
                                
                                <p className="text-xs text-slate-500 text-center animate-pulse">
                                    ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏Å‡∏≤‡∏Å‡∏ö‡∏≤‡∏ó‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
                                </p>
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
